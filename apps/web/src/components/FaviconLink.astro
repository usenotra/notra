---
  interface Props {
    href: string;
  }

  const { href, ...rest } = Astro.props;

  const hostname = new URL(href).hostname;
  const isExternalLink = hostname !== null;
  const faviconUrl = isExternalLink
    ? `https://icons.duckduckgo.com/ip3/${hostname}.ico`
    : null;

  const invertedFavicons = ["github.com"];
  const isInvertedFavicon = invertedFavicons.includes(hostname);
---
{isExternalLink ? (
  <a href={href} {...rest} target="_blank" rel="noopener noreferrer" class="favicon-link">
    <img
      src={faviconUrl}
      alt=""
      class:list={["favicon-icon", { "favicon-inverted": isInvertedFavicon }]}
      width="16"
      height="16"
      loading="lazy"
    />
    <slot />
  </a>
) : (
  <a href={href} {...rest} target="_blank" rel="noopener noreferrer">
    <slot />
  </a>
)}

<style>
  .favicon-link {
    display: inline-flex;
    align-items: center;
    gap: 4px;
  }

  .favicon-icon {
    display: inline-block;
    width: 16px;
    height: 16px;
    vertical-align: middle;
    flex-shrink: 0;
    margin-bottom: unset;
    margin-top: unset;
  }

  @media (prefers-color-scheme: dark) {
    .favicon-inverted {
      filter: invert(1);
    }
  }
</style>
